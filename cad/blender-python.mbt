///|
pub async fn Design::write_blender_python(
  self : Design,
  out_path : String?,
) -> Unit {
  let bpy_code = self.to_blender_python()
  write_text_file(bpy_code, out_path)
}

///|
/// Convert the Design to a Blender 5 Python3 script that will recreate the model
/// using the Blender Python3 API.
pub fn Design::to_blender_python(self : Design) -> String {
  let builder = StringBuilder::new()
  builder.write_string(
    (
      $|#!/usr/bin/env python3
      $|"""
      $|Blender 5.0 Python3 script generated by `gmlewis/step` and MoonBit.
      $|Run this script from within Blender's scripting environment.
      $|This script is idempotent meaning that it can be run multiple times and
      $|only the created model will be replaced in the current scene.
      $|"""
      $|
      $|import bpy
      $|
      $|
      $|def set_up_collection(collection_name):
      $|    """
      $|    Set up the collection for the new model.
      $|    - If it exists, delete all objects within it.
      $|    - If it doesn't exist, create it.
      $|    """
      $|    scene = bpy.context.scene
      $|    collection = bpy.data.collections.get(collection_name)
      $|
      $|    if collection is not None:
      $|        print(f"Collection '{collection_name}' exists. Removing all objects...")
      $|        objects_to_delete = list(collection.objects)
      $|        for obj in objects_to_delete:
      $|            bpy.data.objects.remove(obj, do_unlink=True)
      $|        print(f"  Removed {len(objects_to_delete)} objects.")
      $|    else:
      $|        print(f"Creating new collection '{collection_name}'...")
      $|        collection = bpy.data.collections.new(collection_name)
      $|        scene.collection.children.link(collection)
      $|
      $|    return collection
      $|
      $|
      $|def main():
      $|    # Create or reuse a named collection (based upon the name of this model).
      $|    # Delete all children of the collection in the case that it already exists.
      $|    collection_name = config.get('collectionName', '\{self.name} Collection')
      $|    print(f"\nSetting up collection '{collection_name}'...")
      $|    collection = set_up_collection(collection_name)
      $|
      $|    # TODO...
      $|
      $|if __name__ == "__main__":
      $|    main()
    ),
  )
  //
  builder.to_string()
}
